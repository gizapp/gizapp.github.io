<html>
<head>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Recursive:wght@300..800&display=swap');
  * {
    font-family:Recursive, sans-serif;
  }
  h1 {
    font-size:5em;
    margin:0;
    font-weight:300;
  }
  input {
    padding:0.5em;
  }
  .cmdEntry {
    width:100%;
    position:absolute;
    transition:top 0.5s, width 0.5s;
    display:flex;
    top:0em;
    overflow:hidden;
  }
  svg {
    fill:none;
    stroke:black;
    stroke-linecap:round;
    stroke-linejoin:round;
  }
</style>
</head>
<body>
<center>
  <svg viewBox="-90 -30 180 60"
    style="stroke-width:2px;height:8em">
    <path d="M 58,-23 H 92 M 74,-23 V 25 M 32,-12 C 32,-12 32,-12 32,-12 M 32,-12 C 32,-12 44,-25 44,-25 M 44,-25 C 44,-25 44,-25 44,-25 M 44,-25 C 44,-25 44,-25 44,-1 M 44,-1 C 44,23 44,23 44,23 M 55,23 C 55,23 55,23 55,23 M 55,23 C 55,23 44,23 44,23 M 44,23 C 44,23 32,23 32,23 M -11,0 V 0 M -11,0 C -11,-16 -3,-24 4.8,-24 M 4.8,-24 C 12,-24 15,-21 15,-21 M 15,-21 V -21 M -11,0 V 0 M 3.8,-3 C 11,-3 18,1.2 18,10 M 18,10 C 18,18 12,24 3.8,24 M 3.8,24 C -4,24 -11,18 -11,0 M -43,-12 C -43,-12 -43,-12 -43,-12 M -43,-12 C -43,-12 -30,-25 -30,-25 M -30,-25 C -30,-25 -30,-25 -30,-25 M -30,-25 C -30,-25 -30,-25 -30,-1 M -30,-1 C -30,23 -30,23 -30,23 M -19,23 C -19,23 -19,23 -19,23 M -19,23 C -19,23 -31,23 -31,23 M -31,23 C -31,23 -43,23 -43,23 M -80,-24 V 24 C -66,24 -54,22 -54,0 -54,-22 -64,-24 -80,-24 Z"></path>
  </svg>
</center>
<center>
  <h1>animator</h1>
</center>
<hr/>
<center>
  <svg viewBox="-18 -32 36 64"
    style="stroke-width:3px;height:10em">
    <path><animate id="close" dur="0.5s" fill="freeze" attributeName="d"></animate></path>
  </svg>
  <svg viewBox="-18 -32 36 64"
    style="stroke-width:3px;height:10em">
    <path><animate id="close" dur="0.5s" fill="freeze" attributeName="d"></animate></path>
  </svg>
  <svg viewBox="-18 -32 36 64"
    style="stroke-width:3px;height:10em">
    <path><animate id="close" dur="0.5s" fill="freeze" attributeName="d"></animate></path>
  </svg>
  <svg viewBox="-18 -32 36 64"
    style="stroke-width:3px;height:10em">
    <path><animate id="close" dur="0.5s" fill="freeze" attributeName="d"></animate></path>
  </svg>
  <svg viewBox="-18 -32 36 64"
    style="stroke-width:3px;height:10em">
    <path><animate id="close" dur="0.5s" fill="freeze" attributeName="d"></animate></path>
  </svg>
  <svg viewBox="-18 -32 36 64"
    style="stroke-width:3px;height:10em">
    <path><animate id="close" dur="0.5s" fill="freeze" attributeName="d"></animate></path>
  </svg>
</center>
<center>
  <div style="width:20em;position:relative;height:5em">
    <div class="cmdEntry">
      <button style="height:100%;width:3em">▼</button><input onkeyup="newInput()" maxlength="6" style="height:100%;width:calc(100% - 3em)" placeholder="Enter number to animate"/>
    </div>
    <div class="cmdEntry">
      <button style="height:100%;width:3em">▼</button><input onkeyup="newDigitInput()" maxlength="1" style="height:100%;width:calc(100% - 3em)" placeholder="Enter digit to animate"/>
    </div>
    <div class="cmdEntry">
      <button style="height:100%;width:3em">▼</button><button style="height:100%;width:calc(100% - 3em)">Animate</button>
    </div>
    <script>
      const entryHeight = 2
      const spacing = 0.5
      const minimizedWidth = 5
      let cmdPanel = document.getElementsByTagName('script')
      currentScript = cmdPanel[cmdPanel.length -1]
      cmdPanel = currentScript.parentNode
      cmdPanel.removeChild(currentScript)
      mainPile = [...cmdPanel.children]
      const maxZ = mainPile.length
      for (const entry of mainPile) {
        entry.style.height = entryHeight + 'em'
        entry.navButton = entry.children[0]
        entry.formFields = [...entry.children].slice(1)
        entry.style.zIndex = maxZ
      }
      const makeDiscardButton = btn => {
        btn.innerText = '▼'
        btn.onclick = discardUI
      }
      makeDiscardButton(mainPile.at(-1).navButton)
      mainPile[0].removeChild(mainPile[0].navButton)
      mainPile[0].style.width = "100%"
      delete mainPile[0].navButton
      discardPile = []
      let ondiscardui = null
      function discardUI() {
        if (mainPile.length > 1) {
          const movedEntry = mainPile.pop()
          if (ondiscardui)
            ondiscardui(movedEntry)
          discardPile.push(movedEntry)
          movedEntry.style.top = entryHeight + spacing + 'em'
          movedEntry.navButton.onclick = returnUI
          movedEntry.navButton.innerText = '▲'
          movedEntry.style.width = minimizedWidth + 'em'
          if (movedEntry.ondiscard)
            movedEntry.ondiscard()
          for (const elem of movedEntry.formFields)
            elem.setAttribute('disabled', 'disabled')
          const zIndex = -mainPile.length + maxZ
          movedEntry.ontransitionend = function (e) {
            this.style.zIndex = zIndex
            this.ontransitionend = null
            ondiscardui = null
          }
          if (mainPile.at(-1).navButton)
            makeDiscardButton(mainPile.at(-1).navButton)
          ondiscardui = function (entry) {
            if (movedEntry.ontransitionend)
              movedEntry.ontransitionend()
            ondiscardui = null
          }
        }
      }
      function returnUI() {
        const movedEntry = discardPile.pop()
        movedEntry.style.zIndex = maxZ
        makeDiscardButton(movedEntry.navButton)
        movedEntry.ontransitionend = null
        movedEntry.style.width = null
        movedEntry.style.top = 0 + 'em'
        for (const elem of movedEntry.formFields)
          elem.removeAttribute('disabled')
        if (mainPile.at(-1).navButton)
          mainPile.at(-1).navButton.onclick = null
        mainPile.push(movedEntry)
      }
    </script>
  </div>
</center>
<script>
  const digits = ['M-15 0c0 0 0 0 0 0M-15 0C-15-16-8-24 0-24M0-24C8-24 15-18 15 0m0 0c0 0 0 0 0 0M-15 0c0 0 0 0 0 0M15 0c0 0 0 0 0 0M15 0C15 18 8 24 0 24M0 24C-8 24-15 18-15 0','M-12-12c0 0 0 0 0 0M-12-12C-12-12 1-25 1-25M1-25c0 0 0 0 0 0M1-25C1-25 1 23 1 23M-12 23c0 0 0 0 0 0M12 23c0 0 0 0 0 0M12 23C12 23 0 23 0 23M0 23C0 23-12 23-12 23','M-12-12c0 0 0 0 0 0M-12-12C-12-18-8-24 0-24M0-24C8-24 12-20 12-11M12-11C12-2 0 5 0 5M0 5C0 5-12 12-12 23M13 23c0 0 0 0 0 0M13 23C13 23 1 23 1 23M1 23C1 23-12 23-12 23','M-11-17c0 0 0 0 0 0M-11-17C-11-17-8-24 0-24M0-24C8-24 12-20 12-12M12-12C12-6 8-1-2-1M-12 17c0 0 0 0 0 0M-2-1C8-1 12 3 12 12M12 12C12 20 8 24 0 24M0 24C-8 24-11 19-12 17','M-16 10c0 0 0 0 0 0M-16 10C-16 10 6-25 6-25M6-25c0 0 0 0 0 0M6-25C6-25 6 25 6 25M-16 10c0 0 0 0 0 0M15 10c0 0 0 0 0 0M15 10C15 10-1 10-1 10M-1 10C-1 10-16 10-16 10','M-2-4C-2-4-11-4-11-4M-11-4C-11-4-11-23-11-23M-11-23C-11-23 11-23 11-23M11-23c0 0 0 0 0 0M-12 17c0 0 0 0 0 0M-2-4C8-4 12 1 12 10M12 10C12 18 8 24 0 24M0 24C-8 24-11 19-12 17','M-15 0c0 0 0 0 0 0M-15 0C-15-16-7-24 1-24M1-24C8-24 11-21 11-21M11-21c0 0 0 0 0 0M-15 0c0 0 0 0 0 0M -14,10 C -13,-7 14,-8 14,10M14 10C14 18 8 24 0 24M0 24C-8 24-15 18-15 0','M-15-23c0 0 0 0 0 0M-15-23C-15-23 15-23 15-23M15-23c0 0 0 0 0 0M15-23C15-23 6-10 1 2M1 2C-4 14-6 25-6 25M-6 25c0 0 0 0 0 0M-6 25c0 0 0 0 0 0M-6 25c0 0 0 0 0 0','M0-2C-7-2-13-6-13-13M-13-13C-13-20-7-24 0-24M0-24C7-24 13-21 13-13M13-13C13-5 7-2 0-2M0-2C-8-2-15 3-15 11M0-2C8-2 15 2 15 11M15 11C15 20 8 24 0 24M0 24C-8 24-15 20-15 11','M 14,-10 C 13,7 -14,8 -14,-10M -14,-10 C -14,-18 -8,-24 0,-24M 0,-24 C 8,-24 15,-18 15,0M15 0c0 0 0 0 0 0M-11 21c0 0 0 0 0 0M15 0c0 0 0 0 0 0M15 0C15 16 7 24-1 24M-1 24C-8 24-11 21-11 21']
  const anim = document.getElementsByTagName('animate')
  const input = mainPile[0].formFields[0]
  const digitInput = mainPile[1].formFields[0]
  const animateBtn = mainPile[2].formFields[0]
  let animating = false
  let lastNumber = ''
  let targetNumber = ''
  const nullDigit = 'M0,0c0,0 0,0 0,0M0,0c0,0 0,0 0,0M0,0c0,0 0,0 0,0M0,0c0,0 0,0 0,0M0,0c0,0 0,0 0,0M0,0c0,0 0,0 0,0M0,0c0,0 0,0 0,0M0,0c0,0 0,0 0,0'
  for (let elem of anim)
    elem.parentNode.setAttribute('d', nullDigit)
  function animateDigit(anim, digit) {
    digit = Number(digit)
    anim.setAttribute('from', anim.getAttribute('to'));
    if (!isNaN(digit)) {
      anim.setAttribute('to', digits[digit]);
    } else {
      anim.setAttribute('to', nullDigit);
    }
    anim.beginElement()
  }
  function animateStr(str) {
    for(let i = 0; i < anim.length; i++)
      animateDigit(anim[i], str[i + str.length - anim.length])
    animating = true;
    lastNumber = str
    targetNumber = str
  }
  anim[anim.length-1].onend = e => {
    if (targetNumber != lastNumber)
      animateStr(input.value)
    else
      animating = false
  }
  function newInput() {
    if (!animating && input.value !== lastNumber)
      animateStr(input.value);
    else
      targetNumber = input.value
  }
  function newDigitInput() {
    let digit = event.key
    if (isNaN(Number(digit)))
      digit = digitInput.value ? digitInput.value[digitInput.value.length-1] : ''
    const str = digit.repeat(anim.length)
    digitInput.value = digit
    if (!animating && str !== lastNumber)
      animateStr(str);
    else
      targetNumber = str
  }
  let countupInterval = null
  animateBtn.startAnim = function() {
    if (countupInterval == null) {
      countupInterval = setInterval(() => {
        num = Number(lastNumber) + 1
        if (isNaN(num))
          num = 0
        animateStr(String(num))
      }, 1000)
    }
    this.innerText = 'Animating...'
    this.onclick = this.stopAnim
  }
  animateBtn.stopAnim = function() {
    clearInterval(countupInterval)
    countupInterval = null
    this.innerText = 'Animate'
    this.onclick = this.startAnim
  }
  mainPile[2].ondiscard = () => animateBtn.stopAnim()
  animateBtn.onclick = animateBtn.startAnim
</script>
</body>
</html>
